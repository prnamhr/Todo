{% extends "base_menu.html" %}
{% load humanize %}

{% block head %}
<style>
.overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 10;
  display: none;
  background-color: rgba(0, 0, 0, 0.5); /*dim the background*/
}
</style>
{% endblock %}

{% block content %}
{% if ad.content_type %}
<div id="overlay" class="overlay" style="text-align: center;" onclick="document.getElementById('overlay').style.display = 'none';">
  <img style="width: 90%; margin-top: 50px; border: 3px solid black;" src="{% url 'ads:ad_picture' ad.id %}">
</div>
{% endif %}

<span style="float: right;">
  ({{ ad.updated_at|naturaltime }})
  {% if ad.owner == user %}
    <a href="{% url 'ads:ad_update' pk=ad.id %}"><i class="fa fa-pencil"></i></a>
    <a href="{% url 'ads:ad_delete' pk=ad.id %}"><i class="fa fa-trash"></i></a>
  {% endif %}
</span>

<h1>{{ ad.title }}</h1>

{% if ad.content_type %}
  <img style="float: right; max-width: 50%;" src="{% url 'ads:ad_picture' ad.id %}" onclick="document.getElementById('overlay').style.display = 'block';">
{% endif %}

<p>{{ ad.text }}</p>
<p>price: {{ ad.price }}</p>
<!-- Display Comments -->
{% if comments %}
  <h2>Comments:</h2>
  <ul>
    {% for comment in comments %}
    <li>
      <strong>{{ comment.owner.username }}</strong> - {{ comment.created_at|naturaltime }}:<br>
        {{ comment.text }}

        <!-- Show delete icon if the comment belongs to the current user -->
        {% if comment.owner == user %}
         <a href="{% url 'ads:ad_comment_delete' pk=comment.id %}">
            <i class="fa fa-trash" title="Delete Comment"></i>
          </a>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p>No comments yet.</p>
{% endif %}

<!-- Comment Form -->
{% if user.is_authenticated %}
  <h2>Add a Comment:</h2>
  <form method="post" action="{% url 'ads:ad_comment_create' ad.id %}">
    {% csrf_token %}
    {{ comment_form.as_p }}
    <button type="submit">Submit Comment</button>
  </form>
{% else %}
  <p>Please <a href="{% url 'login' %}">login</a> to add a comment.</p>
{% endif %}

<p><a href="{% url 'ads:all' %}">All ads</a></p>
{% endblock %}
